---
import { getPortfolioData } from "@/utils/data";
import { TestimonialCard } from "@/components/testimonials/TestimonialCard";
import { Heading } from "@/components/ui/heading";
import Button from "@/components/ui/Button";

import asger from "@/assets/testimonial/asger.jpg";
import desire from "@/assets/testimonial/desire.jpeg";
import lenny from "@/assets/testimonial/lenny.jpg";
import jony from "@/assets/testimonial/jony.jpg";
import heshan from "@/assets/testimonial/heshan.jpg";
import fredrik2 from "@/assets/testimonial/fredrik2.jpg";
import timothy from "@/assets/testimonial/timothy.jpg";
import erfan from "@/assets/testimonial/erfan.jpg";
import rebecca from "@/assets/testimonial/rebecca.jpg";
import fredrik from "@/assets/testimonial/fredrik.jpg";
import david from "@/assets/testimonial/david.jpg";
import klas from "@/assets/testimonial/klas.jpg";

const imageMap: Record<string, any> = {
	"/img/testimonial/asger.jpg": asger.src,
	"/img/testimonial/desire.jpeg": desire.src,
	"/img/testimonial/lenny.jpg": lenny.src,
	"/img/testimonial/jony.jpg": jony.src,
	"/img/testimonial/heshan.jpg": heshan.src,
	"/img/testimonial/fredrik2.jpg": fredrik2.src,
	"/img/testimonial/timothy.jpg": timothy.src,
	"/img/testimonial/erfan.jpg": erfan.src,
	"/img/testimonial/rebecca.jpg": rebecca.src,
	"/img/testimonial/fredrik.jpg": fredrik.src,
	"/img/testimonial/david.jpg": david.src,
	"/img/testimonial/klas.jpg": klas.src,
};

const { testimonials } = getPortfolioData();
const { showAll = false } = Astro.props;

const testimonialsWithImages = testimonials.map((testimonial) => ({
	...testimonial,
	img: imageMap[testimonial.img] || testimonial.img,
}));
---

<style>
	@keyframes marqueeScroll {
		0% {
			transform: translateX(0%);
		}
		100% {
			transform: translateX(-50%);
		}
	}

	.marquee-inner {
		animation: marqueeScroll 40s linear infinite;
	}

	.marquee-reverse {
		animation-direction: reverse;
	}

	.marquee-inner:hover {
		animation-play-state: paused;
	}
</style>

<section class="clip5 bg-white py-20 dark:bg-neutral-800" id="testimonials">
	<div class="container mx-auto px-4">
		<Heading
			level="h2"
			gradient
			floating
			backplate
			client:idle
			subtitle="Testimonials from clients and colleagues"
		>
			What People Say
		</Heading>

		{
			showAll ? (
				<div class="w-full mt-12 m-auto grid grid-cols-4 items-center gap-2">
					{testimonialsWithImages.map((testimonial) => (
						<TestimonialCard testimonial={testimonial} client:load />
					))}
				</div>
			) : (
				<>
					<div class="marquee-row relative mx-auto w-full max-w-6xl overflow-hidden">
						<div class="pointer-events-none absolute left-0 top-0 z-10 h-full w-20 bg-linear-to-r from-white to-transparent dark:from-neutral-800" />
						<div class="marquee-inner flex min-w-[200%] transform-gpu pb-2 pt-2">
							{[...testimonialsWithImages, ...testimonialsWithImages].map(
								(testimonial) => (
									<TestimonialCard testimonial={testimonial} client:load />
								)
							)}
						</div>
						<div class="pointer-events-none absolute right-0 top-0 z-10 h-full w-20 bg-linear-to-l from-white to-transparent dark:from-neutral-800 md:w-40" />
					</div>

					<div class="marquee-row relative mx-auto w-full max-w-6xl overflow-hidden">
						<div class="pointer-events-none absolute left-0 top-0 z-10 h-full w-20 bg-linear-to-r from-white to-transparent dark:from-neutral-800" />
						<div class="marquee-inner marquee-reverse flex min-w-[200%] transform-gpu pb-5 pt-10">
							{[...testimonialsWithImages, ...testimonialsWithImages]
								.reverse()
								.map((testimonial) => (
									<TestimonialCard testimonial={testimonial} client:load />
								))}
						</div>
						<div class="pointer-events-none absolute right-0 top-0 z-10 h-full w-20 bg-linear-to-l from-white to-transparent dark:from-neutral-800 md:w-40" />
					</div>
				</>
			)
		}

		{
			showAll ? null : (
				<div class="mt-12 text-center">
					<Button
						href="/about/#testimonials"
						text="View All Testimonials â†’"
						variant="secondary"
					/>
				</div>
			)
		}
	</div>
</section>
