---
import { getPortfolioData } from "@/utils/data";
import { TestimonialCard } from "@/components/testimonials/TestimonialCard";
import { Heading } from "@/components/ui/heading";
import Button from "@/components/ui/Button";
import { getTestimonialImage } from "@/utils/testimonialImages";

const { testimonials } = getPortfolioData();
const { showAll = false } = Astro.props;

const testimonialsWithImages = testimonials.map((testimonial) => ({
	...testimonial,
	img: getTestimonialImage(testimonial.img),
}));
---

<style>
	@keyframes marqueeScroll {
		0% {
			transform: translateX(0%);
		}
		100% {
			transform: translateX(-50%);
		}
	}

	.marquee-inner {
		animation: marqueeScroll 40s linear infinite;
	}

	.marquee-reverse {
		animation-direction: reverse;
	}

	.marquee-inner:hover {
		animation-play-state: paused;
	}
</style>

<section class="clip5 bg-white py-20 dark:bg-neutral-800" id="testimonials">
	<div class="container mx-auto px-4">
		<Heading
			level="h2"
			gradient
			floating
			backplate
			client:idle
			subtitle="Testimonials from clients and colleagues"
		>
			What People Say
		</Heading>

		{
			showAll ? (
				<div class="w-full mt-12 m-auto flex flex-wrap max-w-6xl items-center gap-2 justify-center">
					{testimonialsWithImages.map((testimonial) => (
						<TestimonialCard testimonial={testimonial} client:load />
					))}
				</div>
			) : (
				<>
					<div class="marquee-row relative mx-auto w-full max-w-6xl overflow-hidden">
						<div class="pointer-events-none absolute left-0 top-0 z-10 h-full w-20 bg-linear-to-r from-white to-transparent dark:from-neutral-800" />
						<div class="marquee-inner flex min-w-[200%] transform-gpu pb-2 pt-2">
							{[...testimonialsWithImages, ...testimonialsWithImages].map(
								(testimonial) => (
									<TestimonialCard testimonial={testimonial} client:load />
								)
							)}
						</div>
						<div class="pointer-events-none absolute right-0 top-0 z-10 h-full w-20 bg-linear-to-l from-white to-transparent dark:from-neutral-800 md:w-40" />
					</div>

					<div class="marquee-row relative mx-auto w-full max-w-6xl overflow-hidden">
						<div class="pointer-events-none absolute left-0 top-0 z-10 h-full w-20 bg-linear-to-r from-white to-transparent dark:from-neutral-800" />
						<div class="marquee-inner marquee-reverse flex min-w-[200%] transform-gpu pb-5 pt-10">
							{[...testimonialsWithImages, ...testimonialsWithImages]
								.reverse()
								.map((testimonial) => (
									<TestimonialCard testimonial={testimonial} client:load />
								))}
						</div>
						<div class="pointer-events-none absolute right-0 top-0 z-10 h-full w-20 bg-linear-to-l from-white to-transparent dark:from-neutral-800 md:w-40" />
					</div>
				</>
			)
		}

		{
			showAll ? null : (
				<div class="mt-12 text-center">
					<Button
						href="/about/#testimonials"
						text="View All Testimonials â†’"
						variant="secondary"
					/>
				</div>
			)
		}
	</div>
</section>
