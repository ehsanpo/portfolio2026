---
import Layout from '@/layouts/Layout.astro';
import portfolioData from '@/data/portfolio-resume.json';
import { getCollection } from 'astro:content';
import { WorkDetailView } from '@/components/work/WorkDetailView';

export async function getStaticPaths() {
  const companies = portfolioData.companies;
  return companies.map((company) => ({
    params: { slug: company.id },
    props: { company },
  }));
}

const { company } = Astro.props;

// Fetch related portfolio items
const portfolioEntries = await getCollection('portfolio');
const relatedProjects = portfolioEntries.filter(entry => 
  entry.data.agency === company.name || 
  entry.data.client === company.name ||
  (entry.id && entry.id.startsWith(company.id))
);

// Find skill durations from timeline
const skillDurations = portfolioData.timeline.reduce((acc, item) => {
  const name = item.name.toLowerCase();
  acc[name] = item.duration;
  // Add common aliases
  if (name === 'reactjs') acc['react'] = item.duration;
  if (name === 'electron js') acc['electron'] = item.duration;
  if (name === 'vuejs') acc['vue'] = item.duration;
  if (name === 'javascript') acc['js'] = item.duration;
  return acc;
}, {} as Record<string, string>);

---

<Layout title={`${company.name} | ${company.position}`} description={company.description}>
  <WorkDetailView 
    client:load 
    company={company} 
    relatedProjects={relatedProjects} 
    skillDurations={skillDurations} 
  />
</Layout>
