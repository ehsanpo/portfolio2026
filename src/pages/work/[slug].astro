---
import Layout from "@/layouts/Layout.astro";
import portfolioData from "@/data/portfolio-resume.json";
import { getCollection } from "astro:content";
import { WorkDetailView } from "@/components/work/WorkDetailView";

export async function getStaticPaths() {
	const companies = portfolioData.companies;
	return companies.map((company) => ({
		params: { slug: company.id },
		props: { company },
	}));
}

const { company } = Astro.props;

const portfolioEntries = await getCollection("portfolio");
const relatedProjects = portfolioEntries.filter((entry) => {


	console.log("Checking entry:", entry.data.agency, "for company:", company.name, company.id);
	return (
		entry.data.agency === company.name ||
		entry.data.client === company.name ||
		(entry.data.agency && company.name.includes(entry.data.agency)) ||
		(entry.id && entry.id.startsWith(company.id))
	);
});

const skillDurations = portfolioData.timeline.reduce(
	(acc, item) => {
		const name = item.name.toLowerCase();
		acc[name] = item.duration;

		if (name === "reactjs") acc["react"] = item.duration;
		if (name === "electron js") acc["electron"] = item.duration;
		if (name === "vuejs") acc["vue"] = item.duration;
		if (name === "javascript") acc["js"] = item.duration;
		return acc;
	},
	{} as Record<string, string>
);
---

<Layout title={`${company.name} | ${company.position}`} description={company.description}>
	<WorkDetailView
		client:load
		company={company}
		relatedProjects={relatedProjects}
		skillDurations={skillDurations}
	/>
</Layout>
